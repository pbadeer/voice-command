function capitalize(a){return a.charAt(0).toUpperCase()+a.slice(1)}function linebreak(a){var b=/\n\n/g,c=/\n/g;return a.replace(b,"<p></p>").replace(c,"<br>")}function lengthSort(a,b){return a.length!=b.length?a.length-b.length:b>a?-1:a>b?1:0}$(function(){function k(){console.log("Webkit speech api not supported in your browser")}function l(){g||(i.start(),f="",$("#final_span").empty(),$("#interim_span").empty(),$(this).text("done"),g=!0)}function m(){g&&(g=!1,i.stop())}function n(a){a=a.toLowerCase(),success=!1;var b=[];if($.each(c,function(){if($.isArray(this.keyword)){var c=this;this.keyword.sort(lengthSort).reverse(),$(this.keyword).each(function(){var d=this.toLowerCase(),e=String(a).indexOf(d);e>-1&&b.push({keywordIndex:e,keywordObject:c,keyword:d})})}else{var d=this.keyword.toLowerCase(),e=String(a).indexOf(d);e>-1&&b.push({keywordIndex:e,keywordObject:this,keyword:this.keyword})}}),b.length)if(1==b.length){var e=b[0].keywordObject;e.foundKeyword=b[0].keyword,p(a,e)}else{var f,g=1e28,h=!1;$.each(b,function(){g>this.keywordIndex&&(f=this.keywordObject,f.foundKeyword=this.keyword,g=this.keywordIndex);var b=this.keywordObject,c=this.keyword;return $.each(d,function(){var d=String(a).toLowerCase(),e=d.indexOf(String(this).toLowerCase()),f=e+String(this).length,g=d.indexOf(String(c).toLowerCase());return e>0&&(f==g||f+1==g)?(b.foundKeyword=c,p(a,b),h=!0,!1):void 0}),h?!1:void 0}),h||p(a,f)}else o(a)}function o(a){0==a.indexOf("go to")?(a=a.substring("go to".length+1),q(b,a.trim(),"firstHit")):0==a.indexOf("goto")?(a=a.substring("goto".length+1),q(b,a.trim(),"firstHit")):0==a.indexOf("open")?(a=a.substring("open".length+1),r(a),q(b,a.trim(),"firstHit")):($(e).each(function(){return 0==a.indexOf(this.toLowerCase())?(a=a.substring(this.length+1),!1):void 0}),q(b,a.trim()))}function p(a,b){var c=!1;if($(e).each(function(){return 0==a.indexOf(this)?(a=a.substring(this.length+1),!1):void 0}),a.trim()==String(b.foundKeyword).toLowerCase()){var f=b.url.split("/"),g=f[0],h=f[2],i=g+"//"+h;newKeyword={url:i},q(newKeyword,"")}else{console.log(b),$(d).each(function(){var d=String(this)+" "+b.foundKeyword.toLowerCase();return a.indexOf(d)>-1&&a.indexOf(d)==a.length-d.length?(a=a.substring(0,a.length-d.length).trim(),c=!0,!1):void 0});var j=b.foundKeyword.toLowerCase()+" for";0!=a.indexOf(j)||c||(a=a.substring(j.length+1)),c||(a=a.replace(b.foundKeyword.toLowerCase(),"")),q(b,a.trim())}}function q(a,c,d){var e="";a.suffix&&(e=a.suffix),r(d?b.firstHit+encodeURIComponent(c)+e:a.url+encodeURIComponent(c)+e)}function r(a){window.location.href=a}function s(){TweenMax.set($("#button .loading"),{clearProps:"all"}),$("#button").removeClass("cancel"),$("#button #contents").empty(),h=!1,f="",$("#final_span").text("")}function t(){s(),$("#tip").addClass("show"),a&&window.clearTimeout(a),a=setTimeout(function(){$("#tip").removeClass("show")},3e3)}function y(){requestAnimationFrame(y),g?(v.getByteFrequencyData(w),TweenMax.set($(".visual"),{autoAlpha:.75}),TweenMax.set($("#viz1"),{scale:(w[8]+1)/100/x}),TweenMax.set($("#viz2"),{scale:(w[15]+1)/100/x}),TweenMax.set($("#viz3"),{scale:(w[21]+1)/100/x})):TweenMax.set($(".visual"),{autoAlpha:0})}setTimeout(function(){$("#newPage").removeClass("loading")},10);var a,b={url:"https://www.google.com/search?q=",firstHit:"https://www.google.com/search?btnI&q="},c=[{keyword:"Facebook",url:"https://facebook.com/search/?q="},{keyword:"YouTube",url:"https://www.youtube.com/results?search_query="},{keyword:"the noun project",url:"https://thenounproject.com/search/?q="},{keyword:"HBO Go",url:"http://www.hbogo.com/#search&browseMode=browseGrid?searchTerm=",suffix:"/"},{keyword:"define",url:"http://dictionary.reference.com/browse/"},{keyword:"soundcloud",url:"https://soundcloud.com/search?q="},{keyword:"rdio",url:"http://www.rdio.com/search/",suffix:"/"},{keyword:["watch the show","watch the tv show","the show","the tv show","tv shows with","shows with","tv shows by","shows by","television with","television by","television"],url:"https://www.justwatch.com/us/search?content_type=show&q="},{keyword:["watch movies with","watch movies by","movies with","movies by","the movie","movies"],url:"https://www.justwatch.com/us/search?q=",suffix:"&content_type=movie"},{keyword:["weather be like","weather going to be like","weather going to be","weather going to be","weather like","weather be","weather"],url:b.url+"weather%20"},{keyword:["watch","stream","where can i watch"],url:"https://www.justwatch.com/us/search?q="},{keyword:"Evernote",url:"https://www.evernote.com/Home.action?#ses=1&sh=5&sds=3&x=",suffix:"&"},{keyword:"Hulu",url:"http://www.hulu.com/search?q="},{keyword:"Netflix",url:"http://www.netflix.com/search/"},{keyword:["Twitter","Twitter account","Twitter page"],url:"https://twitter.com/search?src=typd&q="},{keyword:"Gmail",url:"https://mail.google.com/mail/u/0/#search/"},{keyword:"Google Keep",url:"https://keep.google.com/#search/text="},{keyword:"Google Photos",url:"https://photos.google.com/search/"},{keyword:"Google Drive",url:"https://drive.google.com/drive/u/0/search?q="},{keyword:"Dropbox",url:"https://www.dropbox.com/search/personal?query_unnormalized="},{keyword:"Google",url:"https://google.com/search?q="},{keyword:["Wikipedia","wiki"],url:"https://en.wikipedia.org/w/index.php?search="},{keyword:"Amazon",url:"http://www.amazon.com/s/?field-keywords="},{keyword:"DuckDuckGo",url:"https://duckduckgo.com/?q="},{keyword:"Pinterest",url:"https://www.pinterest.com/search/?q="},{keyword:"ebay",url:"http://m.ebay.com/sch/i.html?_nkw="},{keyword:"imdb",url:"http://www.imdb.com/find?ref_=nv_sr_fn&s=all&q="},{keyword:["Stackoverflow","stack overflow"],url:b.url+"site:stackoverflow.com+"}],d=["on","on my","in","in my","from","from my","'","'s"],e=["what's the","what is the","what will the","find","show me","show","i want to","give me","let me","search for","look up","look for","search for","search"],f="",g=!1,h=!1;if(e.sort(lengthSort).reverse(),"webkitSpeechRecognition"in window){var i=new webkitSpeechRecognition;i.interimResults=!0,i.continuous=!0,i.onstart=function(){},i.onresult=function(a){for(var b="",c=a.resultIndex;c<a.results.length;++c)a.results[c].isFinal?f+=a.results[c][0].transcript:b+=a.results[c][0].transcript;f=capitalize(f),$("#final_span").empty().html(linebreak(f)),$("#interim_span").empty().html(linebreak(b))}}else k();i.onerror=function(a){},$("#button").on("mousedown touchstart",function(){h?(TweenMax.killAll(),s()):l()}),$(document).on("touchend mouseup",function(){m()}),i.onend=function(){var a=f.toLowerCase();if(""!=a.trim()){g=!1,h=!0;var b={t:0},c="2px solid white",d=$('<div class="element"><div class="loading"></div><div class="slice"></div></div>'),e=$('<div class="loading ring">');$("#button #contents").append(d).append(e),$("#button").addClass("cancel"),TweenMax.to(b,2,{t:100,ease:Linear.easeNone,onUpdate:function(){TweenMax.set($("#button .element .loading"),{rotation:3.6*b.t-45}),b.t>=25&&$("#button > #contents > .loading.ring").css("border-top",c),b.t>=50&&($("#button > #contents > .loading.ring").css("border-right",c),$("#button .element .slice").remove()),b.t>=75&&$("#button > #contents > .loading.ring").css("border-bottom",c)},onComplete:function(){n(a),$("#newPage").addClass("going")}})}else t()};var u,v,w,x=1.5,z=new AudioContext;navigator.webkitGetUserMedia({audio:!0},function(a){console.log("Connected live audio input"),v||(u=z.createMediaStreamSource(a),v=z.createAnalyser(),v.smoothingTimeConstant=.3,v.fftSize=64,w=new Uint8Array(v.frequencyBinCount),u.connect(v)),y()},function(){console.log("Error connecting to audio")})});